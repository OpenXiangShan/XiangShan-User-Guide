---
file_authors_:
- pengxiao <384756158@qq.com> 
---

## 内存子系统

### L1指令Cache

#### 概述

L1指令高速缓存的主要特征如下：

* 指令高速缓存大小可配置，支持16K/32K/64K
* 4路组相联，缓存行大小为64B
* 支持刷新
* 采用PLRU替换算法
* 支持提供两个连续的缓存行
* 支持指令预取功能
* 采用可配置的MSHR管理取指与预取请求
* 支持路查找
* 支持ECC校验
* 支持检查地址翻译错误、物理内存保护错误

#### 路查找队列

昆明湖架构为提高缓存的命中率与访问速度，实现了高速指令缓存的路查找队列（WayLookUp）。路查找队列为先进先出结构，暂存缓存命中信息和指令地址翻译缓存（ITLB）返回的结果，同时监听MSHR写入SRAM的缓存行，对命中信息进行更新。用户可以通过配置`nWayLookupSize`来改变路查找队列的深度，同时可以反压限制预取最大距离。

#### MSHR管理取指与预取请求
MSHR（Miss Status Holding Register）是一种缓存管理结构，用于跟踪和处理缓存缺失（cache miss）事件。当处理器请求的数据在缓存中未找到时，MSHR会记录缺失的状态并管理随后的数据请求。昆明湖架构中，取指请求和预取请求均通过MSHR进行管理，所有MSHR公用一组数据寄存器以减少面积。用户可配置MSRH取指数量寄存器`nFetchMshr`与MSHR预取数量寄存器`nPrefetchMshr`，来分别改变取指与预取的MSHR寄存器数量。

#### ECC校验
昆明湖架构支持对指令高速缓存进行ECC校验。用户可通过配置`DataCodeUnit`来改变校验单元大小，单位为bit。每64bit对应1bit校验位。
